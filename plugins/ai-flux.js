import fetch from 'node-fetch';

let handler = async (m, { text, command, usedPrefix, conn }) => {
  if (!text)
    throw `*ğŸ–¼ï¸ This command generates images from text prompts*\n\n*ğŸ“Œ Example usage:*\nâ—‰ ${usedPrefix + command} Beautiful anime girl\nâ—‰ ${usedPrefix + command} Elon Musk in pink outfit`

  try {
    await m.react('â³');

    const query = encodeURIComponent(text);
    const url = `https://flux.gtech-apiz.workers.dev/?apikey=APIKEY&text=${query}`;

    const res = await fetch(url);

    if (!res.ok) throw `â Failed to generate image: ${res.statusText}`;
    
    const buffer = await res.buffer();
    const caption = `*Generated by Flux*\nğŸ“Œ *Prompt:* ${text}\n\nğŸ”— https://whatsapp.com/channel/0029VagJIAr3bbVBCpEkAM07`;
    
    await conn.sendFile(m.chat, buffer, 'flux.jpg', caption, m);

  } catch (e) {
      m.react('â');
    console.error(e);
    throw `â Failed to generate image. Try again later.\n\n${e.message || e}`;
  }
};

handler.help = ['flux'];
handler.tags = ['ai'];
handler.command = ['flux', 'lexica'];
handler.limit = true
export default handler;
