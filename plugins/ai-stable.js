import fetch from 'node-fetch'

let handler = async (m, { conn, text, usedPrefix, command }) => {
  if (!text)
    throw `*ğŸ–¼ï¸ This command generates images from text prompts*\n\n*ğŸ“Œ Example usage:*\nâ—‰ ${usedPrefix + command} Beautiful anime girl\nâ—‰ ${usedPrefix + command} Elon Musk in pink outfit`

  try {
    m.react('â³')
    const query = encodeURIComponent(text);

    const url = `https://stable.gtech-apiz.workers.dev/?apikey=APIKEY&prompt=${encodeURIComponent(query)}`

    const res = await fetch(url)

if (!res.ok) throw `â Failed to generate image: ${res.statusText}`;
    
    const buffer = await res.buffer();
    const caption = `*Generated by Stable*\nğŸ“Œ *Prompt:* ${text}\n\nğŸ”— https://whatsapp.com/channel/0029VagJIAr3bbVBCpEkAM07`;
    
    await conn.sendFile(m.chat, buffer, 'stable.jpg', caption, m);

  } catch (e) {
      m.react('â');
    console.error(e);
    throw `â Failed to generate image. Try again later.\n\n${e.message || e}`;
  }
};

handler.help = ['stable']
handler.tags = ['ai']
handler.command = ['dalle', 'stable']
handler.limit = true
export default handler
